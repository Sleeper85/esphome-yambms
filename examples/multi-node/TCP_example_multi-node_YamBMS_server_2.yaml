# Updated : 2025.12.23
# Version : 1.0.0
# GitHub  : https://github.com/Sleeper85/esphome-yambms

# YamBMS TCP Multi-Node Server 2 Example
# See TCP_example_multi-node_YamBMS_server_1.yaml for detailed documentation

substitutions:
  friendly_name: 'YamBMS TCP Server 2'
  hostname: 'yambms-tcp-server-2'
  name: 'yambms-tcp-server-2'
  bms_id: '2' # Different Modbus address from Server 1
  static_ip: '192.168.1.102' # Different IP from Server 1
  gateway_ip: '192.168.1.1'
  subnet_mask: '255.255.255.0'
  dns_ip: '192.168.1.1'

esphome:
  name: ${hostname}
  friendly_name: ${friendly_name}

packages:
  board_base: !include ../../packages/base/device_base.yaml
  board_wifi: !include ../../packages/base/device_base_wifi.yaml

esp32:
  board: esp32dev
  framework:
    type: esp-idf

wifi:
  id: my_network
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  manual_ip:
    static_ip: ${static_ip}
    gateway: ${gateway_ip}
    subnet: ${subnet_mask}
    dns1: ${dns_ip}

logger:
  level: INFO

api:
  reboot_timeout: 0s

ota:
  - platform: esphome

packages:
  bms2_tcp: !include
    file: ../../packages/bms/bms_modbus_tcp_server.yaml
    vars:
      bms_id: '2'
      modbus_uart_id: 'uart_esp_1'
      modbus_role: 'server'

  bms2: !include
    file: ../../packages/bms/bms_JK_UART.yaml
    vars:
      bms_id: '2'
      bms_name: 'JK-BMS 2'
      bms_uart_id: 'uart_esp_2'
      bms_cell_max_cycles: '6000.0'

uart:
  - id: uart_esp_1
    tx_pin: GPIO17
    rx_pin: GPIO16
    baud_rate: 19200
  - id: uart_esp_2
    tx_pin: GPIO14
    rx_pin: GPIO12
    baud_rate: 115200
